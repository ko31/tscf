{"version":3,"sources":["tscf-helper.js"],"names":["$","dateTimePicker","$elem","datetimepicker","dateFormat","attr","timeFormat","separator","changeYear","changeMonth","datePicker","datepicker","select2","max","parseInt","postType","config","minimumInputLength","placeholder","allowClear","ajax","url","TSCF","root","dataType","delay","data","params","q","term","post_type","_wpnonce","nonce","processResults","results","posts","cache","maximumSelectionLength","change","e","value","this","val","join","prev","codeEditor","$textArea","lang","theme","editor","ace","edit","next","get","setTheme","getSession","setMode","setOptions","maxLines","save","getValue","timer","on","clearTimeout","setTimeout","document","ready","each","i","elt","index","find","selector","length","imageEditor","videoEditor","$currentHolder","imageChange","$container","ids","img","push","effect","videoChange","video","preventDefault","wp","media","className","frame","multiple","title","text","library","type","button","select","currentCount","repeatLimit","counter","state","image","src","attachment","toJSON","sizes","thumbnail","full","$div","id","delete","before","open","parents","remove","fileSelector","$currentInput","setUrl","input","file","trigger","livePreview","viewWidth","viewHeight","targetWidth","targetHeight","scale","offset","position","$template","$newElem","html","appendTo","hasClass","$parent","sortable","axis","handle","update","event","ui","item","noHighlight","prefix","nameIndex","prop","replace","arguments","jQuery"],"mappings":"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","file":"../tscf-helper.js","sourcesContent":["/**\n * Metabox helper.\n */\n/* global TSCF:false */\n/* global wp:false */\n(function ($) {\n  'use strict';\n\n  // Timepicker\n  var dateTimePicker = function ($elem) {\n    $elem.datetimepicker({\n      dateFormat : $elem.attr('data-date-format'),\n      timeFormat : $elem.attr('data-time-format'),\n      separator  : $elem.attr('data-separator'),\n      changeYear : true,\n      changeMonth: true\n    });\n  };\n\n  // Date picker\n  var datePicker = function ($elem) {\n    $elem.datepicker({\n      dateFormat : $elem.attr('data-date-format'),\n      changeYear : true,\n      changeMonth: true\n    });\n  };\n\n  // Select2\n  var select2 = function ($elem) {\n    var max = parseInt($elem.attr('data-limit'), 10);\n    var postType = $elem.attr('data-post-type');\n    var config = {\n      minimumInputLength: 1,\n      placeholder       : \"\", // @see {https://github.com/select2/select2/issues/3497}\n      allowClear        : true,\n      ajax              : {\n        url           : TSCF.root + '/posts',\n        dataType      : 'json',\n        delay         : 250,\n        data          : function (params) {\n          return {\n            q        : params.term, // search term\n            post_type: postType,\n            _wpnonce : TSCF.nonce\n          };\n        },\n        processResults: function (data, params) {\n          return {\n            results: data.posts\n          };\n        },\n        cache         : true\n      }\n    };\n    if (0 < max) {\n      config.maximumSelectionLength = max;\n    }\n    $elem.select2(config);\n    $elem.change(function (e) {\n      var value = $(this).val();\n      if ( null === value ) {\n        value = '';\n      } else if ('string' !== typeof value) {\n        value = value.join(',');\n      }\n      $(this).prev('input').val(value);\n    });\n  };\n\n  // Code Editor\n  var codeEditor = function ($textArea) {\n    var lang = $textArea.attr('data-language');\n    var theme = $textArea.attr('data-theme');\n    var editor = ace.edit($textArea.next('.tscf__ace').get(0));\n    editor.setTheme('ace/theme/' + theme);\n    editor.getSession().setMode('ace/mode/' + lang);\n    editor.setOptions({\n      maxLines: 500\n    });\n    var save = function () {\n      $textArea.val(editor.getValue());\n    };\n    var timer = null;\n    editor.getSession().on('change', function (e) {\n      if (timer) {\n        clearTimeout(timer);\n      }\n      timer = setTimeout(save, 1000);\n    });\n  };\n\n\n  // Datepicker\n  $(document).ready(function () {\n    // Date time picker\n    $('.tscf__datetimepicker').each(function (i, elt) {\n      dateTimePicker($(elt));\n    });\n    // Date picker\n    $('.tscf__datepicker').each(function (i, elt) {\n      datePicker($(elt));\n    });\n    // select2\n    $('.tscf__input--token').each(function (i, elt) {\n      select2($(elt));\n    });\n    // Ace\n    $('.tscf__input--ace').each(function (i, elt) {\n      codeEditor($(elt));\n    });\n    // Activate datepicker if newly created.\n    $('.tscf--iterator').on('created.tscf', '.tscf__child', function () {\n      var $elem;\n      $.each([\n        ['datetimepicker', dateTimePicker],\n        ['datepicker', datePicker],\n        ['input--token', select2],\n        ['input--ace', codeEditor]\n      ], function (index, config) {\n        if (( $elem = $(this).find($('.tscf__'+config[0])).selector ) && $elem.length ) {\n          $elem.each(function (i, elt) {\n            config[1]($(elt));\n          });\n        }\n      });\n    });\n  });\n\n\n  //\n  // Media picker\n  //\n  // ----------------------------------\n  //\n  $(document).ready(function () {\n\n    var imageEditor,\n        videoEditor,\n        $currentHolder;\n\n    function imageChange($container) {\n      var ids = [];\n      $container.find('img').each(function (index, img) {\n        ids.push($(img).attr('data-image-id'));\n      });\n      $container.prev('input[type=hidden]').val(ids.join(','));\n      $container.effect('highlight', {}, 1000);\n    }\n\n    function videoChange($container) {\n      var ids = [];\n      $container.find('video').each(function (index, video) {\n        ids.push($(video).attr('data-video-id'));\n      });\n      $container.prev('input[type=hidden]').val(ids.join(','));\n      $container.effect('highlight', {}, 1000);\n    }\n\n    $('.tscf')\n      .on('click', '.tscf__image--add', function (e) {\n        e.preventDefault();\n        $currentHolder = $(this).prev('.tscf__placeholder');\n        var currentCount = $currentHolder.find('img').length;\n        var limit = parseInt($currentHolder.attr('data-limit'), 10);\n        if (currentCount >= limit) {\n          return;\n        }\n        if (!imageEditor) {\n          // Create editor if not exists\n          imageEditor = wp.media({\n            className: 'media-frame tscf__imageEditor',\n            frame    : 'select',\n            multiple : true,\n            title    : $(this).text(),\n            library  : {\n              type: 'image'\n            },\n            button   : {\n              text: TSCF.select\n            }\n          });\n          // Bind event\n          imageEditor.on('select', function () {\n            var currentCount = $currentHolder.find('img').length;\n            var limit = parseInt($currentHolder.attr('data-limit'), 10);\n            var repeatLimit = limit - currentCount;\n            var counter = 0;\n            imageEditor.state().get('selection').each(function (image) {\n              if (counter < repeatLimit) {\n                var attachment = image.toJSON();\n                var src;\n                if (attachment.sizes.thumbnail) {\n                  //サムネイルがあればその画像\n                  src = attachment.sizes.thumbnail.url;\n                } else {\n                  //なければフルサイズを取得\n                  src = attachment.sizes.full.url;\n                }\n                var $div = $('<div class=\"tscf__image\">' +\n                  '<img data-image-id=\"' + attachment.id + '\" class=\"tscf__image--object\" src=\"' + src + '\" />' +\n                  '<a class=\"button tscf__image--delete\" href=\"#\">' + TSCF.delete + '</a></div>');\n                $currentHolder.find('.tscf__placeholder--limit').before($div);\n              }\n              counter++;\n            });\n            imageChange($currentHolder);\n          });\n        }\n        // Open image editor\n        imageEditor.open();\n      })\n      .on('click', '.tscf__image--delete', function (e) {\n        e.preventDefault();\n        var $container = $(this).parents('.tscf__placeholder');\n        $(this).parents('.tscf__image').remove();\n        imageChange($container);\n      });\n\n    $('.tscf')\n      .on('click', '.tscf__video--add', function (e) {\n        e.preventDefault();\n        $currentHolder = $(this).prev('.tscf__placeholder');\n        var currentCount = $currentHolder.find('video').length;\n        var limit = parseInt($currentHolder.attr('data-limit'), 10);\n        if (currentCount >= limit) {\n          return;\n        }\n        if (!videoEditor) {\n          // Create editor if not exists\n          videoEditor = wp.media({\n            className: 'media-frame tscf__videoEditor',\n            frame    : 'select',\n            multiple : true,\n            title    : $(this).text(),\n            library  : {\n              type: 'video'\n            },\n            button   : {\n              text: TSCF.select\n            }\n          });\n          // Bind event\n          videoEditor.on('select', function () {\n            var currentCount = $currentHolder.find('video').length;\n            var limit = parseInt($currentHolder.attr('data-limit'), 10);\n            var repeatLimit = limit - currentCount;\n            var counter = 0;\n            videoEditor.state().get('selection').each(function (video) {\n              if (counter < repeatLimit) {\n                var attachment = video.toJSON();\n                var src;\n                src = attachment.url;\n                var $div = $('<div class=\"tscf__video\">' +\n                  '<video data-video-id=\"' + attachment.id + '\" class=\"tscf__video--object\" src=\"' + src + '\" />' +\n                  '<a class=\"button tscf__video--delete\" href=\"#\">' + TSCF.delete + '</a></div>');\n                $currentHolder.find('.tscf__placeholder--limit').before($div);\n              }\n              counter++;\n            });\n            videoChange($currentHolder);\n          });\n        }\n        // Open video editor\n        videoEditor.open();\n      })\n      .on('click', '.tscf__video--delete', function (e) {\n        e.preventDefault();\n        var $container = $(this).parents('.tscf__placeholder');\n        $(this).parents('.tscf__video').remove();\n        videoChange($container);\n      });\n  });\n\n\n  //\n  // URL Selector\n  //\n  // ----------------------------------\n  //\n  $(document).ready(function () {\n\n    var fileSelector,\n        $currentInput,\n        setUrl = function (input) {\n          $(input).parents('.tscf__url--wrapper').find('.tscf-preview-button').attr('href', $(input).val());\n        };\n\n    // Previewer\n    $('.tscf')\n      .on('click', '.tscf-select-button', function (e) {\n        e.preventDefault();\n        $currentInput = $(this).parents('.tscf__url--wrapper').find('.tscf__input--url');\n        // Create editor if not exists\n        if (!fileSelector) {\n\n          fileSelector = wp.media({\n            className: 'media-frame tscf__fileSelector',\n            frame    : 'select',\n            multiple : false,\n            title    : '',\n            button   : {\n              text: TSCF.select\n            }\n          });\n          // Bind event\n          fileSelector.on('select', function () {\n            fileSelector.state().get('selection').each(function (file) {\n              $currentInput.val(file.get('url'));\n              $currentInput.trigger('change');\n            });\n          });\n        }\n        fileSelector.open();\n      })\n      .on('change keyup', '.tscf__input--url', function () {\n        setUrl(this);\n      });\n\n    $('.tscf__input--url').each(function (index, input) {\n      setUrl(input);\n    });\n\n    $(\".tscf-preview-button\").livePreview({\n      trigger     : 'click',\n      viewWidth   : 400,\n      viewHeight  : 300,\n      targetWidth : 1200,\n      targetHeight: 900,\n      scale       : '0.3333',\n      offset      : 50,\n      position    : 'left'\n    });\n  });\n\n  //\n  // Iterator\n  //\n  // ----------------------------------\n  //\n  // Add button for iterator.\n  $('.tscf--iterator').on('click', '.tscf__add', function (e) {\n    e.preventDefault();\n    // Check if max\n    var $container = $(this).parents('.tscf--iterator'),\n        max        = parseInt($container.attr('data-max'), 10),\n        $template  = $container.find('.tscf__template');\n    if (!max || $container.find('.tscf__child').length < max) {\n      var $newElem = $($template.html());\n      $newElem.appendTo($container.find('.tscf__childList'));\n      $container.trigger('compute.tscf');\n      $newElem.trigger('created.tscf');\n    }\n  });\n\n  // Remove button for iterator\n  $('.tscf--iterator').on('click', '.tscf__button', function (e) {\n    e.preventDefault();\n    if ($(this).hasClass('tscf__button--delete')) {\n      var $parent = $(this).parents('.tscf--iterator');\n      $(this).parents('.tscf__child').remove();\n      $parent.trigger('compute.tscf');\n    }\n  });\n\n  // Sortable\n  $('.tscf__childList').sortable({\n    axis       : 'y',\n    handle     : '.tscf__button--move',\n    placeholder: 'tscf__child--placeholder',\n    update     : function (event, ui) {\n      ui.item.parents('.tscf--iterator').trigger('compute.tscf');\n    }\n  });\n\n  // Change index\n  $('.tscf--iterator').on('compute.tscf', function (e, noHighlight) {\n    var prefix = $(this).attr('data-prefix'),\n        length = 0;\n    if (!noHighlight) {\n      $(this).effect('highlight', {}, 500);\n    }\n    $(this).find('.tscf__child').each(function (index, elt) {\n      length++;\n      $.each(['id', 'for', 'name'], function (nameIndex, prop) {\n        $(elt).find('[' + prop + '^=' + prefix + '_]').each(function (i, input) {\n          $(input).attr(prop, $(input).attr(prop).replace(/_[0-9]+(\\[?)/, function () {\n            return '_' + ( index + 1 ) + arguments[1];\n          }));\n        });\n      });\n    });\n    $(this).find('.tscf__index').val(length);\n  });\n\n  // Set initial value\n  $(document).ready(function () {\n    $('.tscf--iterator').trigger('compute.tscf', [true]);\n  });\n\n\n})(jQuery);\n"]}